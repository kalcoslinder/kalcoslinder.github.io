<!DOCTYPE html>
 <html>
  <head>
   <title>Processing.js Template </title>
   <script type="text/javascript" src="processing-1.6.6.min.js"></script>
   <script type="text/javascript" src="init.js"></script>
   <script type="text/css" src="main.css"></script>
   <link rel="stylesheet" href="main.css">
  </head>
  <body>
<!-- Snow Background -->

<script type="application/processing">
void setup(){
width = 400;
height = 400;
}

/*****FALLING SNOW******/
//A simple program designed to mimic falling snow
/****INSTRUCTIONS******/
//Left click - snowstorm!
//Right click - zoom in (toggle)

stroke(255,255,255);
var xs = []; // 398 - xs[col] = row
frameRate(30);
var speed = 0.1;
var c = "rand";
var pN;
var ps = [];
var rate = 1;
var oldX = 0; 
var oldY = 0;
var zoom = false;
for(var i = 0; i < 400; i++){
    xs.push(400-1);
}

var p = function(){
    this.x = parseInt(random(0,400),10);
    this.y = 0;
    this.s = parseInt(random(1*speed,100*speed),10)/10;
    if(this.s < 0.1){
        this.s = 0.1;
    }
    if(c === "dirt"){
    this.c = color(random(65,95),random(10,50),random(0,20));
    }
    if(c === "rand"){
    this.c = color(random(0,255),random(0,255),random(0,255));
    }
    if(c === "red"){
        this.c = color(255, 0, 0);
    }
    if(c === "white"){
        this.c = color(255,255,255);
    }
};
p.prototype.draw = function() {
    stroke(this.c);
    point(this.x,this.y-1);
    this.y+=this.s;
};

var isFull = function(val){
    if(val < -2){
    
    return true;    
    }
};

draw = function() {
    background(0, 0, 0);
    scale(1);
    for(var i = 0; i < ps.length; i++){
        if(ps[i].y >= xs[ps[i].x] && ps[i].s !== 0){
            ps[i].y = xs[ps[i].x] + 1;
            ps[i].sr = 0;
            ps[i].s = 0;
            xs[ps[i].x]--;
            
            var r = parseInt(random(0,2),10);
            var chi = -1;
            if(r === 0){
                //check left 
                chi = -1;
            }
            if(r === 1){
                //check right
                chi = 1;
            }
            var run = false;
            for( var a = 0; a < 2; a++){
                if(chi === -1 && ps[i].x > 2){
                    run = true;
                }
                if(chi === 1 && ps[i].x < 399){
                    run = true;
                }
                //println(400-ps[i].y - (398 - xs[ps[i].x + chi]));
               // if(run && random(0,1+400-ps[i].y - (398 - xs[ps[i].x + chi])) > 1){
                
                if (run && 400-ps[i].y - (398 - xs[ps[i].x + chi]) > 1 ){ //2 higher than left or right
                    
                        xs[ps[i].x] ++;
                        //ps[i].c = color(255,0,0);
                        ps[i].x += chi;
                        //ps[i].y += 1;
                        ps[i].s = 0.1;
                        
                    
    
                }
                
                chi*=-1;
            }
        }
        ps[i].draw();
    }
    if(!xs.every(isFull)){
        while(speed < rate){
        pN = new p();
        if(xs[pN.x] >= -2){
            ps.push(pN);
        }
        fill(255, 255, 255);
        speed++;
        }
        speed = 0.1;
    }
};

mousePressed = function(){
    if(mouseButton === RIGHT && zoom === false){
    oldX = mouseX;
    oldY = mouseY;
    pushMatrix();
    translate(200-mouseX,mouseY-200);
    scale(5);
    translate(-mouseX,-mouseY);
    zoom = true;
    }
    else if(mouseButton === RIGHT && zoom === true){
        popMatrix();
        oldX = 0;
        oldY = 0;
        zoom = false;
    }
    
    
    for(var i = 0; i < ps.length; i++){
        ps[i].s *= 12;    
    }
    speed = 20;
    rate = 12;
};

mouseReleased = function(){
    for(var i = 0; i < ps.length; i++){
        ps[i].s /= 12;    
    }
    speed = random(0.1,1);
    rate = 1;
};

keyPressed = function(){
    if(keyCode - 48 === 1){
        c = "rand";
    }
    if(keyCode - 48 === 2){
        c = "red";
    }
    if(keyCode - 48 === 3){
        c = "white";
    }
    if(keyCode - 48 === 0){
        println(frameCount);
    
    
    }
};




</script>
<canvas id = "myBackground">
</canvas>

<!--The Processing Code-->
   <script type="application/processing">
void setup(){
    size(400,400);
}
var bobX = 0;
var ground = 363;
var timeStep = 0;
var time = 0; //time for running animations
var s = 4; //Defines length of animation frames
var run = true;
var screen = 0;
var shop = "closed";
var animState = "";
var c = -1;

var lineDraw = function(arr1,arr2){
    strokeWeight(2);
    line(arr1[0],arr1[1],arr2[0],arr2[1]);
};
var stickman = function(){
this.posX = 20;
this.posY = 150; //Change to 0 for a fun drop-in!
this.height = 0;
this.frame = "";
this.head = [this.posX+14,this.posY-15];
this.neck = [this.posX+12,this.posY-9];
this.torso = [this.posX+11,this.posY-7];
this.waist = [this.posX+8,this.posY-1];
this.rknee = [this.posX+7,this.posY+5];
this.lknee = [this.posX+12,this.posY+5];
this.rfoot = [this.posX,this.posY+8];
this.lfoot = [this.posX+13,this.posY+10];
this.lhand = [this.posX+14,this.posY-2];
this.rhand = [this.posX+4,this.posY-3];
};
stickman.prototype.run1 = function() {
this.frame = "run1";
this.head = [this.posX-3*c,this.posY-14];
this.neck = [this.posX-6*c,this.posY-8];
this.torso = [this.posX-8*c,this.posY-5];
this.waist = [this.posX-10*c,this.posY];
this.rknee = [this.posX-5*c,this.posY+5];
this.lknee = [this.posX-15*c,this.posY+5];
this.rfoot = [this.posX-2*c,this.posY+12];
this.lfoot = [this.posX-20*c,this.posY+2];
this.lhand = [this.posX-16*c,this.posY-6];
this.rhand = [this.posX,this.posY-2];
};
stickman.prototype.run2 = function() {
this.frame = "run2";
this.head = [this.posX+c*(-3+4*timeStep),this.posY-14];
this.neck = [this.posX+c*(-6+5*timeStep),this.posY-8];
this.torso = [this.posX+c*(-8+5*timeStep),this.posY-5];
this.waist = [this.posX+c*(-10+5*timeStep),this.posY+1*timeStep];
this.rknee = [this.posX+c*(-5+5*timeStep),this.posY+5+2*timeStep];
this.lknee = [this.posX+c*(-15+7*timeStep),this.posY+5+1*timeStep];
this.rfoot = [this.posX+c*(-2),this.posY+12];
this.lfoot = [this.posX+c*(-20+6*timeStep),this.posY+2+5*timeStep];
this.lhand = [this.posX+c*(-16+6*timeStep),this.posY-6+3*timeStep];
this.rhand = [this.posX+c*(+1*timeStep),this.posY-2+2*timeStep];
};
stickman.prototype.run3 = function() {
this.frame = "run3";
this.head = [this.posX+c*(+1+3*timeStep),this.posY-14+1*timeStep];
this.neck = [this.posX+c*(-1+3*timeStep),this.posY-8-2*timeStep];
this.torso = [this.posX+c*(-3+3*timeStep),this.posY-5-2*timeStep];
this.waist = [this.posX+c*(-5+4*timeStep),this.posY+1-2*timeStep];
this.rknee = [this.posX+c*(+1*timeStep),this.posY+7-1*timeStep];
this.lknee = [this.posX+c*(-8+9*timeStep),this.posY+6-2*timeStep];
this.rfoot = [this.posX+c*(-2),this.posY+12];
this.lfoot = [this.posX+c*(-14+8*timeStep),this.posY+7];
this.lhand = [this.posX+c*(-10+12*timeStep),this.posY-3+1*timeStep];
this.rhand = [this.posX+c*(+1-4*timeStep),this.posY-1*timeStep];
};
stickman.prototype.run4 = function() {
this.frame = "run4";
this.head = [this.posX+c*(+4+5*timeStep),this.posY-12-3*timeStep];
this.neck = [this.posX+c*(+2+4*timeStep),this.posY-10+1*timeStep];
this.torso = [this.posX+c*(+5*timeStep),this.posY-7];
this.waist = [this.posX+c*(-1+3*timeStep),this.posY-1];
this.rknee = [this.posX+c*(+1+2*timeStep),this.posY+6-1*timeStep];
this.lknee = [this.posX+c*(+1+5*timeStep),this.posY+4+1*timeStep];
this.rfoot = [this.posX+c*(-2),this.posY+12];
this.lfoot = [this.posX+c*(-6+8*timeStep),this.posY+7+1*timeStep];
this.lhand = [this.posX+c*(+2+4*timeStep),this.posY-2];
this.rhand = [this.posX+c*(-3+3*timeStep),this.posY-1-1*timeStep];
};
stickman.prototype.run5 = function() {
this.frame = "run5";
this.head = [this.posX+c*(+9+3*timeStep),this.posY-15];
this.neck = [this.posX+c*(+6+3*timeStep),this.posY-9];
this.torso = [this.posX+c*(+5+3*timeStep),this.posY-7];
this.waist = [this.posX+c*(+2+3*timeStep),this.posY-1];
this.rknee = [this.posX+c*(+3+1*timeStep),this.posY+5];
this.lknee = [this.posX+c*(+6+4*timeStep),this.posY+5-2*timeStep];
this.rfoot = [this.posX+c*(-2),this.posY+12];
this.lfoot = [this.posX+c*(+2+6*timeStep),this.posY+8];
this.lhand = [this.posX+c*(+6+4*timeStep),this.posY-2];
this.rhand = [this.posX+c*(+2*timeStep),this.posY-2];
};
stickman.prototype.run6 = function() {
this.frame = "run6";
this.head = [this.posX+c*(+12+2*timeStep),this.posY-15];
this.neck = [this.posX+c*(+9+3*timeStep),this.posY-9];
this.torso = [this.posX+c*(+8+3*timeStep),this.posY-7];
this.waist = [this.posX+c*(+5+3*timeStep),this.posY-1];
this.rknee = [this.posX+c*(+4+3*timeStep),this.posY+5];
this.lknee = [this.posX+c*(+10+2*timeStep),this.posY+3+2*timeStep];
this.rfoot = [this.posX+c*(-2+2*timeStep),this.posY+12-4*timeStep];
this.lfoot = [this.posX+c*(+8+5*timeStep),this.posY+8+2*timeStep];
this.lhand = [this.posX+c*(+10+4*timeStep),this.posY-2];
this.rhand = [this.posX+c*(+2+2*timeStep),this.posY-2-1*timeStep];
};
stickman.prototype.run7 = function() {
this.frame = "run7";
this.head = [this.posX+c*(+14 + 1*timeStep),this.posY-15];
this.neck = [this.posX+c*(+13),this.posY-9];
this.torso = [this.posX+c*(+11),this.posY-7];
this.waist = [this.posX+c*(+8 + 2*timeStep),this.posY-1];
this.rknee = [this.posX+c*(+7),this.posY+5];
this.lknee = [this.posX+c*(+12 + 2*timeStep),this.posY+5];
this.rfoot = [this.posX,this.posY+8-3*timeStep];
this.lfoot = [this.posX+c*(+13 + 3*timeStep),this.posY+10];
this.lhand = [this.posX+c*(+18*timeStep),this.posY-2];
this.rhand = [this.posX+c*(4+-1*timeStep),this.posY-3-2*timeStep];
};
stickman.prototype.recordPos = function() {
    this.frame = "recordPos";
    this.com = (this.head[0]+this.neck[0]+this.torso[0]+this.waist[0]+this.rknee[0]+this.lknee[0]+this.rfoot[0]+this.lfoot[0]+this.lhand[0]+this.rhand[0])/10;
    this.oldHead = this.head;
    this.oldNeck = this.neck;
    this.oldTorso = this.torso;
    this.oldWaist = this.waist;
    this.oldRknee = this.rknee;
    this.oldLknee = this.lknee;
    this.oldRfoot = this.rfoot;
    this.oldLfoot = this.lfoot;
    this.oldRhand = this.rhand;
    this.oldLhand = this.lhand;
    
};
stickman.prototype.idle1 = function() {
//lerp takes the value in slot one, transforms it to value in slot two
this.frame = "idle1";
this.head[0] = lerp(this.oldHead[0],this.com,timeStep);
this.neck[0] = lerp(this.oldNeck[0],this.com,timeStep);
this.torso[0] = lerp(this.oldTorso[0],this.com,timeStep);
this.waist[0] = lerp(this.oldWaist[0],this.com,timeStep);
this.head[1] = lerp(this.oldHead[1],this.posY-13, timeStep);
this.neck[1] = lerp(this.oldNeck[1],this.posY-7, timeStep);
this.torso[1] = lerp(this.oldTorso[1],this.posY-5, timeStep);
this.waist[1] = lerp(this.oldWaist[1],this.posY+1, timeStep);
this.rknee[1] = lerp(this.oldRknee[1],this.posY+7, timeStep);
this.lknee[1] = lerp(this.oldLknee[1],this.posY+7, timeStep);
this.rfoot[1] = lerp(this.oldRfoot[1],this.posY+12, timeStep);
this.lfoot[1] = lerp(this.oldLfoot[1],this.posY+12, timeStep);
this.lhand[1] = lerp(this.oldLhand[1],this.posY+1, timeStep);
this.rhand[1] = lerp(this.oldRhand[1],this.posY+2, timeStep);

if(this.frame === "run1" || this.frame === "run2" || this.frame === "run3"){
//Switch the chirality for these frames
this.rknee[0] = lerp(this.oldRknee[0],this.com+3,timeStep);
this.lknee[0] = lerp(this.oldLknee[0],this.com-3,timeStep);
this.rfoot[0] = lerp(this.oldRfoot[0],this.com+5,timeStep);
this.lfoot[0] = lerp(this.oldLfoot[0],this.com-5,timeStep);
this.lhand[0] = lerp(this.oldLhand[0],this.com-4,timeStep);
this.rhand[0] = lerp(this.oldRhand[0],this.com+4,timeStep);
}
else{
this.rknee[0] = lerp(this.oldRknee[0],this.com-3,timeStep);
this.lknee[0] = lerp(this.oldLknee[0],this.com+3,timeStep);
this.rfoot[0] = lerp(this.oldRfoot[0],this.com-5,timeStep);
this.lfoot[0] = lerp(this.oldLfoot[0],this.com+5,timeStep);
this.lhand[0] = lerp(this.oldLhand[0],this.com+4,timeStep);
this.rhand[0] = lerp(this.oldRhand[0],this.com-4,timeStep);
}
};
stickman.prototype.idle2 = function() { //For when running begins
this.frame = "idle2";
this.head[0] = lerp(this.com,this.posX+c*(+1+3),timeStep);
this.neck[0] = lerp(this.com,this.posX+c*(-1+3),timeStep);
this.torso[0] = lerp(this.com,this.posX+c*(-3+3),timeStep);
this.waist[0] = lerp(this.com,this.posX+c*(-5+4),timeStep);
this.head[1] = lerp(this.posY-13,this.posY-14+1, timeStep);
this.neck[1] = lerp(this.posY-7,this.posY-8-2, timeStep);
this.torso[1] = lerp(this.posY-5,this.posY-5-2, timeStep);
this.waist[1] = lerp(this.posY+1,this.posY+1-2, timeStep);

this.rknee[0] = lerp(this.com-3,this.posX+c*(-8+9),timeStep);
this.lknee[0] = lerp(this.com+3,this.posX+c*(+1),timeStep);
this.rfoot[0] = lerp(this.com-5,this.posX+c*(-14+8),timeStep);
this.lfoot[0] = lerp(this.com+5,this.posX+c*(-2),timeStep);
this.lhand[0] = lerp(this.com+4,this.posX+c*(-10+12),timeStep);
this.rhand[0] = lerp(this.com-4,this.posX+c*(+1-4),timeStep);
this.rknee[1] = lerp(this.posY+7,this.posY+6-2, timeStep);
this.lknee[1] = lerp(this.posY+7,this.posY+7-1, timeStep);
this.rfoot[1] = lerp(this.posY+12,this.posY+7, timeStep);
this.lfoot[1] = lerp(this.posY+12,this.posY+12, timeStep);
this.lhand[1] = lerp(this.posY+1,this.posY-3+1, timeStep);
this.rhand[1] = lerp(this.posY+2,this.posY-1, timeStep);

};
stickman.prototype.draw = function() {
this.com = (this.head[0]+this.neck[0]+this.torso[0]+this.waist[0]+this.rknee[0]+this.lknee[0]+this.rfoot[0]+this.lfoot[0]+this.lhand[0]+this.rhand[0])/10;
stroke(0, 0, 0);
fill(255, 255, 255);
lineDraw(this.neck,this.torso);
lineDraw(this.waist,this.torso);
lineDraw(this.lknee,this.waist);
lineDraw(this.rknee,this.waist);
lineDraw(this.lfoot,this.lknee);
lineDraw(this.rfoot,this.rknee);
lineDraw(this.neck,this.lhand);
lineDraw(this.neck,this.rhand);
ellipse(this.head[0],this.head[1],10,10);

};

var bob = new stickman();

draw = function() {
    pushMatrix();
    background(255, 255, 255);
    //Sidewalk
    stroke(0, 0, 0);
    strokeWeight(2);
    fill(179, 179, 179);
    rect(-1,363,401,36);
    
    //Make bob run
    {
    if(run)
    {   
        //Increase time
        time++;
        if(time >= 7*s){
            bob.posX+=c*21; //??????
            time = 0;
        }
        if(bob.posX > 400){
            bob.posX = 0;
            screen ++;
        }
        if(bob.posX < 0){
            bob.posX = 400;
            screen--;
        }
        if(time < 7*s){
            timeStep = time/(7*s);
            bob.run7();
        }
        if(time < 6*s){
            timeStep = time/(6*s);
            bob.run6();
        }
        if(time < 5*s){
            timeStep = time/(5*s);
        bob.run5();
        }
        if(time < 4*s){
            timeStep = time/(4*s);
        bob.run4();
        }
        if(time < 3*s){
            timeStep = time/(3*s);
        bob.run3();
        }
        if(time < 2*s){
        timeStep = time/(2*s);     
        bob.run2();
        }
        if(time < 1*s){
        timeStep = time/(1*s);    
        bob.run1();
        }
    }
    //Set bob to idle animation when down key is pressed
    if(keyCode === DOWN){
        if(run === true){ //This runs just once
            run = false;
            time = 0; //Set time to 0 to count frames
            bob.recordPos();
            bob.state = "stop";
        }
        if(time < 8*s){ //Repeats (4) times 
            time++;
            timeStep = time/(8*s);
            bob.idle1();
        }
    }
    //Start running again when right is pressed
    if((keyCode === RIGHT || keyCode === LEFT) && run === false && shop === "closed"){ 
        if(keyCode === RIGHT){
            c = +1;
        }
        if(keyCode === LEFT){
            c = -1;
        }
        if(bob.state === "stop")
        {
            bob.state = "start";
            bob.posX = bob.com + c*7;
            time = 0;
        }
        if(time < 2*s)
        {
            time++;
            timeStep = time/(2*s);
            bob.idle2();
        }
        else
        { //If stop frames are complete, reset time for animation 2
            time = 2*s;
            run = true;
        }
    }
    }
    pushMatrix();
    translate(0,200);
    bob.draw();
    bobX = bob.waist[0];
    popMatrix();
    
    
};


   </script>
   <canvas></canvas>
   
   <a href="BouncingBall.html"><h1>Bounce</h1></a>

   <a href="Blocks.html"><h1>Blocks</h1></a>

   <a href="Snowfall.html"><h1>Snowfall</h1></a>

   <a href="Stickman.html><h1>Stick Simulator</h1></a>

  </body>
 </html>
